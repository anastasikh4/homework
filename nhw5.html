<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Frozen Grammar Quest</title>
    <link href="https://fonts.googleapis.com/css2?family=Raleway:wght@400;700;900&display=swap" rel="stylesheet">
    <style>
        body { 
            background-color: #caf0f8; 
            background-image: url('https://www.transparenttextures.com/patterns/snow.png');
            font-family: 'Raleway', sans-serif; 
            display: flex; flex-direction: column; align-items: center; padding: 20px; color: #03045e; 
            overflow-x: hidden;
        }
        .ice-track { width: 100%; max-width: 500px; height: 10px; background: #90e0ef; border-radius: 20px; position: relative; margin-bottom: 30px; margin-top: 20px; }
        #olaf { position: absolute; left: 0%; font-size: 35px; transition: 0.8s ease; top: -35px; }

        .game-box { 
            background: rgba(255, 255, 255, 0.9); 
            width: 100%; max-width: 500px; padding: 30px; 
            border-radius: 40px; box-shadow: 0 20px 40px rgba(0,119,182,0.2); 
            text-align: center; border: 6px solid #ade8f4; color: #03045e;
            position: relative; min-height: 450px;
        }
        .step-indicator { font-weight: 900; color: #0077b6; margin-bottom: 10px; text-transform: uppercase; font-size: 14px; }
        
        .scramble-pool { display: flex; gap: 10px; justify-content: center; margin: 20px 0; min-height: 50px; flex-wrap: wrap; }
        .word-pill { background: #00b4d8; color: white; padding: 12px 18px; border-radius: 50px; cursor: pointer; font-weight: 900; box-shadow: 0 4px 0 #0077b6; }
        
        .answer-zone { display: flex; gap: 10px; justify-content: center; margin: 20px 0; border-bottom: 4px solid #caf0f8; min-height: 60px; padding-bottom: 10px; flex-wrap: wrap; }
        .answer-word { background: #fff; padding: 10px 15px; border-radius: 15px; font-weight: 900; color: #03045e; border: 2px solid #90e0ef; cursor: pointer; animation: ice-pop 0.3s; }

        @keyframes ice-pop { 0% { transform: scale(0.5); } 100% { transform: scale(1); } }

        #snowflake-overlay {
            display: none; position: absolute; top: 0; left: 0; width: 100%; height: 100%;
            background: rgba(255,255,255,0.95); border-radius: 35px;
            flex-direction: column; justify-content: center; align-items: center; z-index: 10;
        }

        .mc-option { background: #f0faff; border: 2px solid #ade8f4; padding: 15px; border-radius: 20px; margin-bottom: 10px; cursor: pointer; font-weight: bold; width: 100%; font-family: 'Raleway'; font-size: 18px; }
        .start-btn { background: #0077b6; color: white; border: none; padding: 20px 50px; border-radius: 50px; font-weight: 900; font-size: 22px; cursor: pointer; }
    </style>
</head>
<body>

<div class="ice-track"><div id="olaf">‚õÑ</div></div>

<div class="game-box" id="game-box">
    <div id="snowflake-overlay">
        <h2 style="color: #0077b6;">MAGIC! ‚ùÑÔ∏è</h2>
    </div>

    <div id="content">
        <h1 style="color:#0077b6;">Frozen Quest</h1>
        <p>Click START to hear the Magic Voice!</p>
        <button class="start-btn" onclick="startGame()">START MISSION ‚ùÑÔ∏è</button>
    </div>
</div>

<script>
    let currentStep = 1;
    let qIdx = 0;
    const content = document.getElementById('content');
    const overlay = document.getElementById('snowflake-overlay');
    const olaf = document.getElementById('olaf');

    const ex1Data = [
        { eng: ["Am", "I", "cold?"], speak: "Am I cold?" },
        { eng: ["Are", "you", "ready?"], speak: "Are you ready?" },
        { eng: ["Is", "he", "fast?"], speak: "Is he fast?" },
        { eng: ["Is", "she", "happy?"], speak: "Is she happy?" },
        { eng: ["Is", "it", "snowing?"], speak: "Is it snowing?" },
        { eng: ["Are", "we", "friends?"], speak: "Are we friends?" },
        { eng: ["Are", "they", "brave?"], speak: "Are they brave?" },
        { eng: ["Is", "Elsa", "queen?"], speak: "Is Elsa queen?" },
        { eng: ["Is", "Olaf", "funny?"], speak: "Is Olaf funny?" },
        { eng: ["Are", "you", "sad?"], speak: "Are you sad?" }
    ];

    const ex2Data = [
        { eng: ["Yes,", "she", "is"], cue: "üëß", symbol: "‚úÖ" },
        { eng: ["No,", "he", "isn't"], cue: "üë¶", symbol: "‚ùå" },
        { eng: ["Yes,", "they", "are"], cue: "üë®‚Äçüë©‚Äçüëß", symbol: "‚úÖ" }
    ];

    const ex3Data = [
        { cue: "üëß", symbol: "‚úÖ", ans: "Yes, she is", options: ["Yes, she is", "No, he isn't", "Yes, they are"] },
        { cue: "üë¶", symbol: "‚ùå", ans: "No, he isn't", options: ["No, she isn't", "No, he isn't", "No, I am not"] },
        { cue: "üë®‚Äçüë©‚Äçüëß", symbol: "‚úÖ", ans: "Yes, they are", options: ["Yes, it is", "Yes, she is", "Yes, they are"] },
        { cue: "üê∂", symbol: "‚ùå", ans: "No, it isn't", options: ["No, it isn't", "No, we aren't", "No, he isn't"] },
        { cue: "üë¶", symbol: "‚úÖ", ans: "Yes, he is", options: ["Yes, he is", "Yes, she is", "Yes, I am"] },
        { cue: "I", symbol: "‚ùå", ans: "No, I am not", options: ["No, she isn't", "No, I am not", "No, they aren't"] }
    ];

    // MOBILE VOICE ACTIVATOR
    function startGame() {
        // Essential for mobile browsers to unlock audio
        window.speechSynthesis.cancel();
        const silentMsg = new SpeechSynthesisUtterance(" ");
        window.speechSynthesis.speak(silentMsg);
        
        loadQuestion();
    }

    function speak(t) {
        window.speechSynthesis.cancel();
        const utterance = new SpeechSynthesisUtterance(t);
        const voices = window.speechSynthesis.getVoices();
        
        // Find a male voice
        const maleVoice = voices.find(v => v.name.toLowerCase().includes('david') || v.name.toLowerCase().includes('male')) || voices[0];
        
        utterance.voice = maleVoice;
        utterance.lang = 'en-US';
        utterance.rate = 0.8;
        window.speechSynthesis.speak(utterance);
    }

    function loadQuestion() {
        content.innerHTML = "";
        overlay.style.display = "none";
        
        // Update Olaf
        let total = ex1Data.length + ex2Data.length + ex3Data.length;
        let current = (currentStep === 1 ? qIdx : currentStep === 2 ? ex1Data.length + qIdx : ex1Data.length + ex2Data.length + qIdx);
        olaf.style.left = (current / total * 90) + "%";

        if (currentStep === 1) {
            let sText = ex1Data[qIdx].speak;
            content.innerHTML = `
                <div class="step-indicator">‚ùÑÔ∏è Step 1: Question Time</div>
                <button onclick="speak('${sText}')" style="font-size:80px; border:none; background:none; cursor:pointer;">‚ùÑÔ∏è</button>
                <p>Build the question!</p>
                <div class="answer-zone" id="answer-zone"></div>
                <div class="scramble-pool" id="pool"></div>
            `;
            renderWords(ex1Data[qIdx].eng);
            setTimeout(() => speak(sText), 500);
        } else if (currentStep === 2) {
            const q = ex2Data[qIdx];
            content.innerHTML = `
                <div class="step-indicator">‚ú® Step 2: Answers</div>
                <div style="font-size:70px;">${q.cue} ${q.symbol}</div>
                <div class="answer-zone" id="answer-zone"></div>
                <div class="scramble-pool" id="pool"></div>
            `;
            renderWords(q.eng);
        } else if (currentStep === 3) {
            const q = ex3Data[qIdx];
            content.innerHTML = `
                <div class="step-indicator">üëë Step 3: Choose</div>
                <div style="font-size:70px;">${q.cue} ${q.symbol}</div>
                <div id="options-box"></div>
            `;
            q.options.forEach(opt => {
                const b = document.createElement('button');
                b.className = 'mc-option';
                b.innerText = opt;
                b.onclick = () => { if(opt === q.ans) showMagic(); else b.style.background = '#ffddd2'; };
                document.getElementById('options-box').appendChild(b);
            });
        }
    }

    function renderWords(words) {
        const pool = document.getElementById('pool');
        [...words].sort(() => Math.random() - 0.5).forEach(w => {
            const b = document.createElement('div');
            b.className = 'word-pill';
            b.innerText = w;
            b.onclick = () => {
                const zone = document.getElementById('answer-zone');
                const az = document.createElement('div');
                az.className = 'answer-word';
                az.innerText = w;
                az.onclick = () => { az.remove(); b.style.display = "block"; };
                zone.appendChild(az);
                b.style.display = "none";
                if(zone.children.length === words.length) {
                    if(Array.from(zone.children).map(c => c.innerText).join(' ') === words.join(' ')) showMagic();
                    else zone.style.borderColor = "red";
                }
            };
            pool.appendChild(b);
        });
    }

    function showMagic() {
        overlay.style.display = "flex";
        setTimeout(nextQuest, 1300);
    }

    function nextQuest() {
        qIdx++;
        let max = (currentStep === 1) ? ex1Data.length : (currentStep === 2) ? ex2Data.length : ex3Data.length;
        if (qIdx >= max) { currentStep++; qIdx = 0; }
        if (currentStep > 3) {
            content.innerHTML = "<h1>‚ùÑÔ∏è ICE MASTER!</h1><div style='font-size:70px'>üè∞üë∏üë∏‚òÉÔ∏è</div>";
            overlay.style.display = "none";
        } else { loadQuestion(); }
    }
</script>
</body>
</html>
